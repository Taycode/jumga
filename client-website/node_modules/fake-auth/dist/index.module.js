import{Base64 as n}from"js-base64";function e(){return(e=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}var t=function(e){return n.encode(JSON.stringify(e))},r=function(){return String(Math.floor(1e4*Math.random()))},o={onChangeCallback:null,getCurrentUser:function(){var n=l("access-token");return i(n).then(function(n){return n.user})},signup:function(n,e){var o=this;return s(n).then(function(u){if(u)throw new m("auth/email-already-in-use","Email is already in use");var a={uid:r(),email:n,password:e},i={user:a,token:t(a)};return c(i).then(function(){return o.changeAccessToken(i.token),i})})},signin:function(n,e){var t=this;return s(n).then(function(n){if(n){if(n.user.password===e)return t.changeAccessToken(n.token),n;throw new m("auth/wrong-password","Password is wrong")}throw new m("auth/user-not-found","Email does not have an account")})},signinWithProvider:function(n){var e=this;return h(n).then(function(n){return e.changeAccessToken(n.token),n})},signout:function(){try{return this.changeAccessToken(null),Promise.resolve()}catch(n){return Promise.reject(n)}},onChange:function(n){var e=this;this.onChangeCallback=n;var t=function(n){i(n).then(function(n){e.onChangeCallback(n||!1)})},r=window.addEventListener("storage",function(n){"access-token"===n.key&&t(JSON.parse(n.newValue))},!1),o=l("access-token");return t(o),function(){window.removeEventListener("storage",r)}},sendPasswordResetEmail:function(n){return s(n).then(function(n){throw n?(w("auth-pass-reset-code",n.token),console.log("Your one-time use password reset code:",n.token),new m("auth/cannot-send-email","You're using Fake Auth, which cannot send password reset emails. These emails normally contain a link to your site with a special reset code. But worry not! Fake Auth has stored the reset code locally in your browser so you can simply go to your change password page now and choose a new password. This enables you to fully test your password reset flow and error states without involving emails.")):new m("auth/user-not-found","Email does not have an account")})},confirmPasswordReset:function(n,e){var t;return e?t=e:(t=l("auth-pass-reset-code"),window.localStorage.removeItem("auth-pass-reset-code-fa5")),d(t,{password:n}).then(function(n){if(n)return!0;throw new m("auth/invalid-action-code","Invalid password update code")})},updateEmail:function(n){return f({email:n}).then(function(n){return n.user})},updatePassword:function(n){return f({password:n}).then(function(n){return n.user})},updateProfile:function(n){return f(n).then(function(n){return n.user})},changeAccessToken:function(n){var e=this;w("access-token",n),this.onChangeCallback&&i(n).then(function(n){e.onChangeCallback(n||!1)})},getAccessToken:function(){return l("access-token")},verifyAccessToken:function(e){return JSON.parse(n.decode(e))}},u=function(){return l("auth-db",[])},a=function(n){return w("auth-db",n)},i=function(n){return p(function(){return u().find(function(e){return e.token===n})})},s=function(n){return p(function(){return u().find(function(e){return e.user.email===n})})},c=function(n){return p(function(){var e=u();e.push(n),a(e)})},f=function(n){var e=l("access-token");if(!e)throw new m("auth/not-signed-in","You must be signed in to perform this action");return d(e,n)},d=function(n,t){return void 0===t&&(t={}),p(function(){var r=u(),o=r.findIndex(function(e){return e.token===n});return-1!==o&&(r[o]=e({},r[o],{user:e({},r[o].user,{},t)}),a(r),r[o])})},h=function(n){return k(),s("demo@gmail.com").then(function(t){return e({},t,{user:e({},t.user,{provider:n})})})};function l(n,e){void 0===e&&(e=null);var t=window.localStorage.getItem(n+"-fa5");return t?JSON.parse(t):e}function w(n,e){window.localStorage.setItem(n+"-fa5",JSON.stringify(e))}var p=function(n){return new Promise(function(e){return setTimeout(function(){e(n())},200)})};function m(n,e){var t=new Error(e);return t.code=n,t}m.prototype=Object.create(Error.prototype);var g={uid:r(),email:"demo@gmail.com",password:"demo"},v={user:g,token:t(g)};function k(){if(!u().find(function(n){return n.user.email===g.email})){var n=u();n.push(v),a(n)}}"undefined"!=typeof window&&k();export default o;
//# sourceMappingURL=index.module.js.map
